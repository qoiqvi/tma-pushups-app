# ĞŸĞ»Ğ°Ğ½ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Telegram Bot Ğ² Next.js

## ğŸ“‹ ĞĞ±Ğ·Ğ¾Ñ€
Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Telegram Ğ±Ğ¾Ñ‚Ğ° Ğ´Ğ»Ñ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹ Ğ¾ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°Ñ… Ğ² Ñ€Ğ°Ğ¼ĞºĞ°Ñ… Next.js Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ webhook API Ğ¸ Ğ²Ğ½ĞµÑˆĞ½ĞµĞ³Ğ¾ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸ĞºĞ°.

## ğŸ¯ Ğ¦ĞµĞ»Ğ¸
1. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ğ±Ğ¾Ñ‚Ğ° (/start, /settings, /stats)
2. Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹ Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ñ‡Ğ°ÑĞ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾ÑÑĞ¾Ğ²
3. Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ¹ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
4. ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° (MVP Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´)

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Telegram      â”‚â”€â”€â”€â”€â”‚   Next.js API    â”‚â”€â”€â”€â”€â”‚   Supabase      â”‚
â”‚   Webhook       â”‚    â”‚   Routes         â”‚    â”‚   Database      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  GitHub Actions  â”‚
                       â”‚  Cron Scheduler  â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‚ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

```
src/
â”œâ”€â”€ app/api/bot/
â”‚   â”œâ”€â”€ webhook/
â”‚   â”‚   â””â”€â”€ route.ts          # Webhook endpoint Ğ´Ğ»Ñ Telegram
â”‚   â”œâ”€â”€ reminders/
â”‚   â”‚   â””â”€â”€ route.ts          # API Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹
â”‚   â””â”€â”€ commands/
â”‚       â””â”€â”€ route.ts          # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
â”œâ”€â”€ lib/bot/
â”‚   â”œâ”€â”€ telegram.ts           # Telegram API client
â”‚   â”œâ”€â”€ handlers.ts           # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
â”‚   â”œâ”€â”€ reminders.ts          # Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹
â”‚   â””â”€â”€ utils.ts              # Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹ Ğ±Ğ¾Ñ‚Ğ°
â””â”€â”€ types/
    â””â”€â”€ bot.ts                # Ğ¢Ğ¸Ğ¿Ñ‹ Ğ´Ğ»Ñ Ğ±Ğ¾Ñ‚Ğ°

.github/workflows/
â””â”€â”€ bot-reminders.yml         # GitHub Actions Ğ´Ğ»Ñ cron
```

## ğŸš€ Ğ­Ñ‚Ğ°Ğ¿Ñ‹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Ğ­Ñ‚Ğ°Ğ¿ 1: Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°

#### 1.1 Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹
```bash
npm install node-telegram-bot-api date-fns-tz
npm install -D @types/node-telegram-bot-api
```

#### 1.2 ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
```bash
# .env.local
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_WEBHOOK_SECRET=random_secret_string
NEXT_PUBLIC_APP_URL=https://your-app.vercel.app
```

#### 1.3 ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° webhook
```typescript
// src/lib/bot/telegram.ts
import TelegramBot from 'node-telegram-bot-api'

export const telegramBot = new TelegramBot(process.env.TELEGRAM_BOT_TOKEN!, {
  webHook: false // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ webhook Ñ‡ĞµÑ€ĞµĞ· API routes
})

export async function setWebhook() {
  const webhookUrl = `${process.env.NEXT_PUBLIC_APP_URL}/api/bot/webhook`
  await telegramBot.setWebHook(webhookUrl, {
    secret_token: process.env.TELEGRAM_WEBHOOK_SECRET
  })
}
```

### Ğ­Ñ‚Ğ°Ğ¿ 2: Webhook API Route

#### 2.1 ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ webhook endpoint
```typescript
// src/app/api/bot/webhook/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { handleBotUpdate } from '@/lib/bot/handlers'
import { verifyTelegramWebhook } from '@/lib/bot/utils'

export async function POST(request: NextRequest) {
  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ Telegram
  const isValid = await verifyTelegramWebhook(request)
  if (!isValid) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  try {
    const update = await request.json()
    await handleBotUpdate(update)
    return NextResponse.json({ ok: true })
  } catch (error) {
    console.error('Bot webhook error:', error)
    return NextResponse.json({ error: 'Internal error' }, { status: 500 })
  }
}
```

#### 2.2 Ğ’ĞµÑ€Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ webhook
```typescript
// src/lib/bot/utils.ts
import crypto from 'crypto'

export async function verifyTelegramWebhook(request: NextRequest): Promise<boolean> {
  const secretToken = process.env.TELEGRAM_WEBHOOK_SECRET
  if (!secretToken) return false

  const headerToken = request.headers.get('X-Telegram-Bot-Api-Secret-Token')
  return headerToken === secretToken
}
```

### Ğ­Ñ‚Ğ°Ğ¿ 3: ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´

#### 3.1 ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº
```typescript
// src/lib/bot/handlers.ts
import { telegramBot } from './telegram'
import { supabaseAdmin } from '@/lib/supabase'
import { BotUpdate, BotMessage } from '@/types/bot'

export async function handleBotUpdate(update: BotUpdate) {
  if (update.message) {
    await handleMessage(update.message)
  }
}

async function handleMessage(message: BotMessage) {
  const chatId = message.chat.id
  const text = message.text
  const user = message.from

  // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ² Ğ‘Ğ”
  await upsertUser(user)

  if (text?.startsWith('/')) {
    await handleCommand(chatId, text, user)
  }
}

async function handleCommand(chatId: number, command: string, user: any) {
  const [cmd, ...args] = command.split(' ')

  switch (cmd) {
    case '/start':
      await handleStartCommand(chatId, user)
      break
    case '/settings':
      await handleSettingsCommand(chatId, user.id)
      break
    case '/stats':
      await handleStatsCommand(chatId, user.id)
      break
    default:
      await telegramBot.sendMessage(chatId, 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ /start Ğ´Ğ»Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°.')
  }
}
```

#### 3.2 ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /start
```typescript
async function handleStartCommand(chatId: number, user: any) {
  const welcomeText = `
ğŸ‹ï¸ Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Pushups Tracker!

Ğ­Ñ‚Ğ¾Ñ‚ Ğ±Ğ¾Ñ‚ Ğ¿Ğ¾Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ²Ğ°Ğ¼ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğ¹ Ğ¸ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚ Ğ¾ Ğ½Ğ¸Ñ… Ğ² Ğ½ÑƒĞ¶Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ.

Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:
/settings - ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹
/stats - Ğ’Ğ°ÑˆĞ° ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°

ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸:
  `

  const keyboard = {
    inline_keyboard: [[
      { 
        text: 'ğŸš€ ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ', 
        web_app: { url: process.env.NEXT_PUBLIC_APP_URL! }
      }
    ]]
  }

  await telegramBot.sendMessage(chatId, welcomeText, {
    reply_markup: keyboard,
    parse_mode: 'HTML'
  })
}
```

#### 3.3 ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° /settings
```typescript
async function handleSettingsCommand(chatId: number, userId: number) {
  const { data: settings } = await supabaseAdmin
    .from('reminder_settings')
    .select('*')
    .eq('user_id', userId)
    .single()

  const currentSettings = settings || {
    days_of_week: [1, 3, 5],
    reminder_time: '09:00:00',
    timezone: 'Europe/Moscow',
    enabled: true
  }

  const daysText = currentSettings.days_of_week
    .map((day: number) => ['Ğ’Ñ', 'ĞŸĞ½', 'Ğ’Ñ‚', 'Ğ¡Ñ€', 'Ğ§Ñ‚', 'ĞŸÑ‚', 'Ğ¡Ğ±'][day])
    .join(', ')

  const settingsText = `
âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹

ğŸ—“ï¸ Ğ”Ğ½Ğ¸: ${daysText}
â° Ğ’Ñ€ĞµĞ¼Ñ: ${currentSettings.reminder_time.slice(0, 5)}
ğŸŒ Ğ§Ğ°ÑĞ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾ÑÑ: ${currentSettings.timezone}
ğŸ”” Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ñ‹: ${currentSettings.enabled ? 'Ğ”Ğ°' : 'ĞĞµÑ‚'}

Ğ”Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ¾Ñ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ.
  `

  const keyboard = {
    inline_keyboard: [[
      { 
        text: 'âš™ï¸ Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸', 
        web_app: { url: `${process.env.NEXT_PUBLIC_APP_URL!}/settings` }
      }
    ]]
  }

  await telegramBot.sendMessage(chatId, settingsText, {
    reply_markup: keyboard
  })
}
```

### Ğ­Ñ‚Ğ°Ğ¿ 4: Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹

#### 4.1 API Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹
```typescript
// src/app/api/bot/reminders/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { sendReminders } from '@/lib/bot/reminders'

export async function POST(request: NextRequest) {
  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (GitHub Actions)
  const authHeader = request.headers.get('Authorization')
  const expectedToken = `Bearer ${process.env.CRON_SECRET}`
  
  if (authHeader !== expectedToken) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  try {
    const result = await sendReminders()
    return NextResponse.json(result)
  } catch (error) {
    console.error('Reminders error:', error)
    return NextResponse.json({ error: 'Failed to send reminders' }, { status: 500 })
  }
}
```

#### 4.2 Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹
```typescript
// src/lib/bot/reminders.ts
import { format, utcToZonedTime } from 'date-fns-tz'
import { telegramBot } from './telegram'
import { supabaseAdmin } from '@/lib/supabase'

export async function sendReminders() {
  const now = new Date()
  const currentDay = now.getDay()
  
  // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ²ÑĞµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹
  const { data: settings, error } = await supabaseAdmin
    .from('reminder_settings')
    .select('*, users(*)')
    .eq('enabled', true)
    .contains('days_of_week', [currentDay])

  if (error || !settings) {
    return { sent: 0, errors: 0 }
  }

  let sent = 0
  let errors = 0

  for (const setting of settings) {
    try {
      // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ñ‡Ğ°ÑĞ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ÑÑĞ°
      const userTime = utcToZonedTime(now, setting.timezone)
      const userHour = format(userTime, 'HH:mm')
      const reminderTime = setting.reminder_time.slice(0, 5)

      // Ğ”Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¿Ğ¾Ğ³Ñ€ĞµÑˆĞ½Ğ¾ÑÑ‚ÑŒ Â±5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
      if (isTimeMatch(userHour, reminderTime)) {
        // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ½Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞ»Ğ¸ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ
        const today = format(now, 'yyyy-MM-dd')
        if (setting.last_sent_at === today) continue

        await sendReminderMessage(setting.user_id, setting.users?.first_name)
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ last_sent_at
        await supabaseAdmin
          .from('reminder_settings')
          .update({ last_sent_at: today })
          .eq('user_id', setting.user_id)

        sent++
      }
    } catch (err) {
      console.error(`Failed to send reminder to ${setting.user_id}:`, err)
      errors++
    }
  }

  return { sent, errors }
}

function isTimeMatch(currentTime: string, targetTime: string): boolean {
  const [currentHour, currentMin] = currentTime.split(':').map(Number)
  const [targetHour, targetMin] = targetTime.split(':').map(Number)
  
  const currentMinutes = currentHour * 60 + currentMin
  const targetMinutes = targetHour * 60 + targetMin
  
  // Ğ”Ğ¾Ğ¿ÑƒÑĞº Â±5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
  return Math.abs(currentMinutes - targetMinutes) <= 5
}

async function sendReminderMessage(userId: number, firstName?: string) {
  const name = firstName ? `, ${firstName}` : ''
  
  const message = `
ğŸ’ª Ğ’Ñ€ĞµĞ¼Ñ Ğ´Ğ»Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸${name}!

ĞĞµ Ğ·Ğ°Ğ±ÑƒĞ´ÑŒÑ‚Ğµ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ¶Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ. Ğ”Ğ°Ğ¶Ğµ Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ»ÑƒÑ‡ÑˆĞµ, Ñ‡ĞµĞ¼ Ğ½Ğ¸ĞºĞ°ĞºĞ¾Ğ¹!

ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ:
  `

  const keyboard = {
    inline_keyboard: [[
      { 
        text: 'ğŸ‹ï¸ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºÑƒ', 
        web_app: { url: process.env.NEXT_PUBLIC_APP_URL! }
      }
    ]]
  }

  await telegramBot.sendMessage(userId, message, {
    reply_markup: keyboard
  })
}
```

### Ğ­Ñ‚Ğ°Ğ¿ 5: GitHub Actions Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº

#### 5.1 Workflow Ñ„Ğ°Ğ¹Ğ»
```yaml
# .github/workflows/bot-reminders.yml
name: Bot Reminders

on:
  schedule:
    # ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğµ Ñ‡Ğ°ÑÑ‹ (UTC)
    - cron: '*/10 6-18 * * *'
  workflow_dispatch: # Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº

jobs:
  send-reminders:
    runs-on: ubuntu-latest
    steps:
      - name: Send reminders
        run: |
          curl -X POST "${{ secrets.APP_URL }}/api/bot/reminders" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json"
```

#### 5.2 GitHub Secrets
Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Settings â†’ Secrets:
- `APP_URL`: https://your-app.vercel.app
- `CRON_SECRET`: ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Ğ­Ñ‚Ğ°Ğ¿ 6: Ğ¢Ğ¸Ğ¿Ñ‹ Ğ¸ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹

#### 6.1 TypeScript Ñ‚Ğ¸Ğ¿Ñ‹
```typescript
// src/types/bot.ts
export interface BotUpdate {
  update_id: number
  message?: BotMessage
}

export interface BotMessage {
  message_id: number
  from: BotUser
  chat: BotChat
  text?: string
  date: number
}

export interface BotUser {
  id: number
  is_bot: boolean
  first_name: string
  last_name?: string
  username?: string
  language_code?: string
  is_premium?: boolean
}

export interface BotChat {
  id: number
  type: 'private' | 'group' | 'supergroup' | 'channel'
  first_name?: string
  last_name?: string
  username?: string
}
```

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
```bash
# 1. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ngrok Ğ´Ğ»Ñ webhook
npm install -g ngrok
ngrok http 3000

# 2. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ webhook URL
curl -X POST "https://api.telegram.org/bot<TOKEN>/setWebhook" \
  -d "url=https://your-ngrok-url.ngrok.io/api/bot/webhook" \
  -d "secret_token=your_secret"

# 3. Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ² Telegram
```

### Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹
```bash
# Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ²Ñ‹Ğ·Ğ¾Ğ² API
curl -X POST "http://localhost:3000/api/bot/reminders" \
  -H "Authorization: Bearer your_secret" \
  -H "Content-Type: application/json"
```

## ğŸ“ Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

- [ ] Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ bot token Ğ² @BotFather
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ webhook API route
- [ ] Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ (/start, /settings)
- [ ] Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹
- [ ] ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ GitHub Actions
- [ ] Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ² GitHub
- [ ] ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ webhook Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾
- [ ] Ğ Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ½Ğ° Vercel
- [ ] Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ webhook Ğ² production
- [ ] ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ

## âš ï¸ Ğ’Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñ‹

1. **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ**: Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ webhook Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ
2. **Rate limiting**: Telegram Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ğ²Ğ°ĞµÑ‚ 30 ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹/ÑĞµĞºÑƒĞ½Ğ´Ñƒ
3. **Error handling**: ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ API gracefully
4. **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³**: Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
5. **Backup**: GitHub Actions Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ½Ğµ ÑÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ - Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ fallback

## ğŸ”® Ğ‘ÑƒĞ´ÑƒÑ‰Ğ¸Ğµ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ

1. **Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸** Ñ‡ĞµÑ€ĞµĞ· inline ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹
2. **Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ñ€ÑĞ¼Ğ¾ Ğ² Ğ±Ğ¾Ñ‚Ğµ** Ñ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ°Ğ¼Ğ¸
3. **ĞœĞ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ** Ñ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸ÑĞ¼Ğ¸
4. **Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¾Ğ²Ñ‹Ğµ Ñ‡Ğ°Ñ‚Ñ‹** Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ½Ñ‹Ñ… Ñ‚Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²Ğ¾Ğº
5. **ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ½Ğ° Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ** Ğ¿Ñ€Ğ¸ Ñ€Ğ¾ÑÑ‚Ğµ Ğ°ÑƒĞ´Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸